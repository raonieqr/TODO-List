(()=>{"use strict";class e{static getLastId(){return parseInt(localStorage.getItem("lastId"))||1}static getStorage(e){return localStorage.getItem(e)}static incrementLastId(){const e=this.getLastId();localStorage.setItem("lastId",String(e+1))}static storeTask(e){const t=this.getLastId(),n=JSON.parse(localStorage.getItem("taskArray"))||[];e.id=t,n.push(e),localStorage.setItem("taskArray",JSON.stringify(n)),this.incrementLastId()}static storeUpdate(e,t){localStorage.removeItem(e),localStorage.setItem(e,JSON.stringify(t))}}document.addEventListener("DOMContentLoaded",(function(){let t=document.getElementById("createTask"),n=document.getElementById("taskForm"),o=document.getElementById("home");const i=document.getElementById("actions");t.addEventListener("click",(function(){t.classList.add("hiddenItem"),o.style.display="none",n.style.display="flex",n.scrollIntoView({behavior:"smooth"})}));let a=document.getElementById("addTask"),r=e.getStorage("taskArray"),l=r?JSON.parse(r):[];function d(e){return/^\d{2}\/\d{2}\/\d{4} \d{2}:\d{2}$/.test(e)}function s(e){const[t,n]=e.split(" "),[o,i,a]=t.split("/"),[r,l]=n.split(":"),d=parseInt(i,10),s=parseInt(r,10),c=parseInt(l,10),u=new Date(a,d-1,o,s,c).getTime()-Date.now();return function(e){return e>12}(d)||function(e,t){return e>23||t>59}(s,c)||function(e,t){return 2===e&&t>29||[4,6,9,11].includes(e)&&t>30||t>31}(d,o)||function(e){return e<0}(u)?0:1}function c(e){return["todo","doing","done"].includes(e)}function u(e){return/^[1-5]$/.test(e)}e.getLastId(),a.addEventListener("click",(function(t){t.preventDefault();let n=function(){const t=["name","description","category","priority","status","dateTime"],n={};for(const e of t)if(n[e]=document.getElementById(e).value,""===n[e].trim())return alert("Error: Todos os campos devem ser preenchidos."),null;return c(n.status)?u(n.priority)?d(n.dateTime)&&s(n.dateTime)?(e.storeTask(n),n):(alert(`Error: data ${n.dateTime} inválida`),null):(alert("Error: Prioridade inválida. Use um número de 1 a 5."),null):(alert("Error: Status inválido. Permitidos: todo, doing ou done."),null)}();n&&(alert(`Tarefa ${n.name} foi criada`),l.push(n),document.querySelectorAll("input[type='text'], select").forEach((e=>e.value="")),localStorage.setItem("taskArray",JSON.stringify(l)))}));let m=document.getElementById("showTask"),y=document.getElementById("tasks"),p=document.getElementById("addTaskList");function h(e){let t=document.createElement("td");return t.innerHTML=e,t}function E(t,n){1===l.length?(l.pop(),i.style.display="none"):l.splice(t,1),e.storeUpdate("taskArray",l),n.parentNode.removeChild(n),0===document.querySelectorAll('input[type="checkbox"]:checked').length&&(i.style.display="none")}function g(e){return function(e){let t=document.createElement("tr");return e.forEach((e=>{t.appendChild(e)})),t}([h('<input type="checkbox" />'),h(e.id),h(e.name),h(e.description),h(e.category),h(e.priority),h(e.status),h(e.dateTime),h('<i id="pencil" class="ph ph-pencil-line"></i><i id="trash" class="ph ph-trash"></i>')])}m.addEventListener("click",(function(){l.length<=0?alert("Lista vazia"):(p.style.display="inline-block",m.style.display="none",n.style.display="none",y.style.display="block",y.scrollIntoView({behavior:"smooth"}),k())}));var f=0;function k(){let e=document.createElement("thead"),t=document.createElement("tbody");for(;y.firstChild;)y.removeChild(y.firstChild);let n=function(){const e=document.createElement("tr");return e.innerHTML="\n      <th></th>\n      <th>Id</th>\n      <th>Nome</th>\n      <th>Descrição</th>\n      <th>Categoria</th>\n      <th>Prioridade</th>\n      <th>Status</th>\n      <th>Data e Hora</th>\n      <th>Ações</th>\n    ",e}();e.appendChild(n);for(let n=0;n<l.length;n++){let o=l[n],i=g(o);t.appendChild(i),y.appendChild(e),y.appendChild(t),i.querySelector("#trash").addEventListener("click",(function(){E(n,i)})),i.querySelector("#pencil").addEventListener("click",(function(){f=n,S(o)}))}var o;(o=document.querySelectorAll('input[type="checkbox"]')).forEach((function(e){e.addEventListener("change",(function(){let e=Array.from(o).some((e=>e.checked));i.style.display=e?"block":"none"}))}))}function v(){let e=Array.from(document.querySelectorAll("#tasks tbody tr")).filter((e=>e.querySelector('input[type="checkbox"]').checked));return selectedRowsArray=e.map((e=>Number(e.querySelector("td:nth-child(2)").textContent))),selectedRowsArray}function I(){let e=document.getElementById("editPageTask");"block"===e.style.display?(p.style.display="block",y.classList.remove("modalBlur"),e.style.display="none"):(e.style.display="block",p.style.display="none",y.classList.add("modalBlur"))}function S(e){I();let t=document.getElementById("nameEdit"),n=document.getElementById("descriptionEdit"),o=document.getElementById("categoryEdit"),i=document.getElementById("priorityEdit"),a=document.getElementById("statusEdit"),r=document.getElementById("dateTimeEdit");t.value=e.name,n.value=e.description,o.value=e.category,i.value=e.priority,a.value=e.status,r.value=e.dateTime}function c(e){return!!["todo","doing","done"].includes(e)||(alert("Erro: Status inválido. Permitidos: todo, doing ou done."),!1)}function u(e){const t=Number(e);return!(isNaN(t)||t<1||t>5)||(alert("Erro: Prioridade inválida. Use um número de 1 a 5."),!1)}function L(){document.querySelectorAll('input[type="radio"]').forEach((e=>e.checked=!1))}function B(){let e=document.getElementById("editStatusTask");"block"===e.style.display?(y.classList.remove("modalBlur"),e.style.display="none",p.style.display="block",document.querySelectorAll('input[type="checkbox"]').forEach((e=>e.checked=!1)),L()):(e.style.display="block",y.classList.add("modalBlur"),i.style.display="none",p.style.display="none")}function T(){m.style.display="none",n.style.display="none",p.style.display="inline-block",y.style.display="block",y.scrollIntoView({behavior:"smooth"}),k(),m.removeEventListener("click",T)}i.addEventListener("click",(function(){B()})),document.getElementById("btnStatusTask").addEventListener("click",(function(){let t=document.querySelectorAll('input[type="radio"]:checked'),n=[];if(n=v(),t.length>0){for(var o=t[0].value;0!==n.length;){let e=n.pop();l.forEach((t=>{t.id===e&&(t.status=o)}))}e.storeUpdate("taskArray",l),k(),alert("Status modificado!"),B()}else alert("Error: selecione uma opção")})),btnEditTask.addEventListener("click",(()=>{!function(t){const n=function(){const e=document.getElementById("nameEdit"),t=document.getElementById("descriptionEdit"),n=document.getElementById("categoryEdit"),o=document.getElementById("priorityEdit"),i=document.getElementById("statusEdit"),a=document.getElementById("dateTimeEdit");return{name:e.value,description:t.value,category:n.value,priority:o.value,status:i.value,dateTime:a.value}}();var o;(function(e){const{name:t,description:n,category:o,priority:i,status:a,dateTime:r}=e;return!!(t&&n&&o&&i&&a&&r)||(alert("Erro: Todos os campos devem ser preenchidos."),!1)})(n)&&c(n.status)&&u(n.priority)&&(d(o=n.dateTime)&&s(o)||(alert(`Erro: Data ${o} inválida`),0))&&function(t,n){return void 0!==l[t]&&(l[t].name=n.name,l[t].description=n.description,l[t].category=n.category,l[t].priority=n.priority,l[t].status=n.status,l[t].dateTime=n.dateTime,e.storeUpdate("taskArray",l),!0)}(t,n)&&(k(),alert(`A tarefa ${l[t].name} foi editada!`),I())}(f)})),document.getElementById("closeModal").addEventListener("click",(function(){I()})),document.getElementById("closeModalStatus").addEventListener("click",(function(){B(),L()})),p.addEventListener("click",(function(){o.style.display="none",p.style.display="none",y.style.display="none",i.style.display="none",n.style.display="flex",n.scrollIntoView({behavior:"smooth"}),m.style.display="block",m.removeEventListener("click",T)}))}))})();